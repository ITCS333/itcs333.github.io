<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Code Editor</title>

  <!-- CodeMirror 5 core -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/codemirror.min.css" />

  <!-- Themes -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/theme/dracula.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/theme/monokai.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/theme/material.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/theme/nord.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/theme/solarized.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/theme/github.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/theme/eclipse.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/theme/mdn-like.min.css" />

  <!-- CodeMirror JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/mode/xml/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/mode/css/css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/addon/edit/closetag.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.17/addon/edit/closebrackets.min.js"></script>

  <!-- LZString compression -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.5.0/lz-string.min.js"></script>

  <style>
    /* â”€â”€ Reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:        #1e1f29;
      --surface:   #282a36;
      --border:    #44475a;
      --accent:    #bd93f9;
      --accent2:   #50fa7b;
      --accent3:   #ff79c6;
      --text:      #f8f8f2;
      --muted:     #6272a4;
      --tab-h:     42px;
      --toolbar-h: 52px;
    }

    /* â”€â”€ Root layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       body is the full-height flex column.
       This is the KEY fix: toolbar is a natural flex child,
       not positioned relative to a calc() height.
       100dvh accounts for mobile browser chrome (address bar).
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    html {
      height: 100%;
    }

    body {
      /* dvh fallback chain: dvh respects mobile browser chrome */
      height: 100vh;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      /* NO overflow:hidden here â€” that's what hid the toolbar */
      overflow: hidden;
      /* Prevent body itself from being wider than the viewport */
      max-width: 100vw;
    }

    /* â”€â”€ Toolbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #toolbar {
      /* Fixed height, never shrinks, never grows */
      height: var(--toolbar-h);
      min-height: var(--toolbar-h);
      flex-shrink: 0;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      /* Horizontal padding only â€” vertical is handled by height */
      padding: 0 12px;
      gap: 8px;
      /* Critical: stop toolbar children from pushing it wider */
      overflow: hidden;
      min-width: 0;
      width: 100%;
    }

    #toolbar h1 {
      font-size: 1rem;
      font-weight: 700;
      color: var(--accent);
      /* Takes leftover space but can shrink and truncate */
      flex: 1 1 auto;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Buttons shrink but don't disappear on small screens */
    .toolbar-btn {
      flex-shrink: 0;
      background: var(--border);
      color: var(--text);
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
      font-size: 0.82rem;
      cursor: pointer;
      transition: background 0.15s;
      white-space: nowrap;
    }
    .toolbar-btn:hover   { background: var(--muted); }
    .toolbar-btn.run     { background: var(--accent2); color: #1e1f29; font-weight: 700; }
    .toolbar-btn.run:hover { filter: brightness(1.1); }
    .toolbar-btn.loading { opacity: 0.6; cursor: wait; }

    /* Theme select â€” also flex-shrink: 0 */
    #theme-select {
      flex-shrink: 0;
      background: var(--border);
      color: var(--text);
      border: none;
      border-radius: 6px;
      padding: 5px 6px;
      font-size: 0.82rem;
      cursor: pointer;
      outline: none;
      /* Cap its width so it doesn't blow out the toolbar */
      max-width: 130px;
    }
    #theme-select:focus { outline: 2px solid var(--accent); }

    .theme-label {
      flex-shrink: 0;
      font-size: 0.78rem;
      color: var(--muted);
      white-space: nowrap;
    }

    /* â”€â”€ App (everything below toolbar) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #app {
      /* Takes all remaining vertical space after the toolbar */
      flex: 1 1 auto;
      min-height: 0;       /* crucial: lets flex child shrink below content size */
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* â”€â”€ Mobile Tab Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #tab-bar {
      flex-shrink: 0;
      display: flex;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      width: 100%;
      overflow: hidden;
    }

    .tab-btn {
      flex: 1;
      height: var(--tab-h);
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      color: var(--muted);
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: color 0.15s, border-color 0.15s;
      letter-spacing: 0.03em;
      /* Prevent individual tab from overflowing */
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    .tab-btn:hover  { color: var(--text); }
    .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); }

    /* â”€â”€ Panels container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #panels {
      flex: 1 1 auto;
      min-height: 0;
      display: flex;
      overflow: hidden;
      position: relative;
    }

    /* â”€â”€ Panel label (desktop only) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .panel-label {
      flex-shrink: 0;
      font-size: 0.72rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
      padding: 5px 10px;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      display: none;
    }

    /* â”€â”€ CodeMirror wrapper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .cm-wrap {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }
    .cm-wrap .CodeMirror {
      flex: 1;
      height: 100% !important;
      font-size: 0.9rem;
      line-height: 1.6;
      font-family: 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
    }

    /* â”€â”€ Editor panels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .editor-panel {
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* â”€â”€ Preview panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #preview-panel {
      display: flex;
      flex-direction: column;
      background: #fff;
    }

    #preview-frame {
      flex: 1;
      border: none;
      width: 100%;
      background: #fff;
    }

    /* â”€â”€ Drag divider â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #divider {
      width: 5px;
      background: var(--border);
      cursor: col-resize;
      flex-shrink: 0;
      transition: background 0.15s;
      display: none;
    }
    #divider:hover,
    #divider.dragging { background: var(--accent); }

    /* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(80px);
      background: var(--accent2);
      color: #1e1f29;
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.85rem;
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s;
      pointer-events: none;
      z-index: 999;
      text-align: center;
      /* Don't let toast be wider than screen */
      max-width: calc(100vw - 32px);
      white-space: pre-line;
    }
    #toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    #toast.error { background: var(--accent3); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MOBILE  (default)
       Each panel is absolutely positioned to fill #panels.
       Only the active one is shown via .hidden.
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #editor-column { display: contents; }

    .editor-panel,
    #preview-panel {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    .editor-panel.hidden,
    #preview-panel.hidden { display: none; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TABLET / DESKTOP  (â‰¥ 768px)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (min-width: 768px) {
      #tab-bar     { display: none; }
      .panel-label { display: block; }

      #editor-column {
        display: flex;
        flex-direction: column;
        flex-shrink: 0;
        width: 50%;
        overflow: hidden;
      }

      .editor-panel,
      #preview-panel {
        position: static;
        width: auto;
        height: auto;
        inset: auto;
      }

      .editor-panel {
        flex: 1;
        min-height: 0;
        border-bottom: 1px solid var(--border);
        display: flex !important;
      }
      .editor-panel:last-child { border-bottom: none; }

      #preview-panel {
        flex: 1;
        min-width: 0;
        display: flex !important;
      }

      #divider     { display: block; }
      .theme-label { display: inline; }
    }

    /* Hide "Theme:" label text on small screens to save space */
    @media (max-width: 600px) {
      .theme-label { display: none; }
    }
  </style>
</head>
<body>

<!-- â”€â”€ Toolbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="toolbar">
  <h1>âš¡ Live Editor</h1>
  <button class="toolbar-btn run" id="btn-run">â–¶ Run</button>
  <button class="toolbar-btn" id="btn-share">â˜ Share</button>
  <button class="toolbar-btn" id="btn-clear">âœ• Clear</button>
  <span class="theme-label">Theme:</span>
  <select id="theme-select" title="Editor theme">
    <optgroup label="Dark">
      <option value="dracula">Dracula</option>
      <option value="monokai">Monokai</option>
      <option value="material">Material</option>
      <option value="nord">Nord</option>
      <option value="solarized dark">Solarized Dark</option>
    </optgroup>
    <optgroup label="Light">
      <option value="default">Default (Light)</option>
      <option value="solarized light">Solarized Light</option>
      <option value="github">GitHub</option>
      <option value="eclipse">Eclipse</option>
      <option value="mdn-like">MDN-like</option>
    </optgroup>
  </select>
</div>

<!-- â”€â”€ App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="app">

  <div id="tab-bar">
    <button class="tab-btn active" data-target="html-panel">HTML</button>
    <button class="tab-btn"        data-target="css-panel">CSS</button>
    <button class="tab-btn"        data-target="js-panel">JS</button>
    <button class="tab-btn"        data-target="preview-panel">Preview</button>
  </div>

  <div id="panels">
    <div id="editor-column">
      <div class="editor-panel" id="html-panel">
        <div class="panel-label">HTML</div>
        <div class="cm-wrap" id="html-cm-wrap"></div>
      </div>
      <div class="editor-panel hidden" id="css-panel">
        <div class="panel-label">CSS</div>
        <div class="cm-wrap" id="css-cm-wrap"></div>
      </div>
      <div class="editor-panel hidden" id="js-panel">
        <div class="panel-label">JS</div>
        <div class="cm-wrap" id="js-cm-wrap"></div>
      </div>
    </div>

    <div id="divider"></div>

    <div id="preview-panel" class="hidden">
      <div class="panel-label">Preview</div>
      <iframe id="preview-frame" sandbox="allow-scripts allow-modals"></iframe>
    </div>
  </div>
</div>

<div id="toast"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   1.  DEFAULTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const DEFAULT = {
  html: `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Page</title>
</head>
<body>
  <h1>Hello, World!</h1>
  <p>Edit the code on the left and click <strong>Run</strong>.</p>
</body>
</html>`,
  css: `/* Your CSS here */
body {
  font-family: system-ui, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  margin: 0;
  background: #f0f4ff;
  color: #1a1a2e;
}
h1 { color: #6c63ff; }`,
  js: `// Your JavaScript here\nconsole.log('Hello from the editor!');`
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   2.  ENCODE / DECODE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function encodeState(obj) {
  return LZString.compressToEncodedURIComponent(JSON.stringify(obj));
}

function decodeState(encoded) {
  try {
    const json = LZString.decompressFromEncodedURIComponent(encoded);
    if (json) return JSON.parse(json);
  } catch (_) {}
  try {
    return JSON.parse(decodeURIComponent(escape(atob(encoded))));
  } catch (_) {}
  return null;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   3.  BUILD SHARE URL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildLongURL() {
  const encoded = encodeState({
    html:  htmlEditor.getValue(),
    css:   cssEditor.getValue(),
    js:    jsEditor.getValue(),
    theme: document.getElementById('theme-select').value,
  });
  const url = new URL(window.location.href);
  url.search = '';
  url.searchParams.set('code', encoded);
  return url.toString();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   4.  URL SHORTENER  (is.gd â€” CORS-friendly, no key needed)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function shortenURL(longURL) {
  const res  = await fetch(
    `https://is.gd/create.php?format=json&url=${encodeURIComponent(longURL)}`
  );
  if (!res.ok) throw new Error(`is.gd ${res.status}`);
  const data = await res.json();
  if (!data.shorturl) throw new Error('No shorturl in response');
  return data.shorturl;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   5.  URL PRELOAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function loadFromURL() {
  try {
    const encoded = new URLSearchParams(window.location.search).get('code');
    return encoded ? decodeState(encoded) : null;
  } catch (e) {
    console.warn('Could not parse ?code= param', e);
    return null;
  }
}

const preloaded    = loadFromURL();
const savedTheme   = localStorage.getItem('cm-theme') ?? 'dracula';
const initialTheme = preloaded?.theme ?? savedTheme;

const initial = {
  html:  preloaded?.html  ?? DEFAULT.html,
  css:   preloaded?.css   ?? DEFAULT.css,
  js:    preloaded?.js    ?? DEFAULT.js,
  theme: initialTheme,
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   6.  CODEMIRROR INSTANCES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const cmOpts = (mode) => ({
  mode,
  theme: initial.theme,
  lineNumbers: true,
  autoCloseTags: true,
  autoCloseBrackets: true,
  indentUnit: 2,
  tabSize: 2,
  indentWithTabs: false,
  lineWrapping: false,
});

const htmlEditor = CodeMirror(document.getElementById('html-cm-wrap'), { ...cmOpts('htmlmixed'), value: initial.html });
const cssEditor  = CodeMirror(document.getElementById('css-cm-wrap'),  { ...cmOpts('css'),       value: initial.css  });
const jsEditor   = CodeMirror(document.getElementById('js-cm-wrap'),   { ...cmOpts('javascript'), value: initial.js  });

document.getElementById('theme-select').value = initial.theme;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   7.  THEME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setTheme(theme) {
  [htmlEditor, cssEditor, jsEditor].forEach(ed => ed.setOption('theme', theme));
  localStorage.setItem('cm-theme', theme);
  document.getElementById('theme-select').value = theme;
}
document.getElementById('theme-select').addEventListener('change', e => setTheme(e.target.value));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   8.  RUN / PREVIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildDocument() {
  const html = htmlEditor.getValue();
  const css  = cssEditor.getValue();
  const js   = jsEditor.getValue();
  const full = /<!doctype/i.test(html) || /<html/i.test(html);

  if (full) {
    let doc = html;
    const s = `<style>${css}</style>`;
    const j = `<script>${js}<\/script>`;
    doc = /<\/head>/i.test(doc) ? doc.replace(/<\/head>/i, `${s}\n</head>`) : s + '\n' + doc;
    doc = /<\/body>/i.test(doc) ? doc.replace(/<\/body>/i, `${j}\n</body>`) : doc + '\n' + j;
    return doc;
  }

  return `<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/>
<style>${css}</style></head><body>${html}<script>${js}<\/script></body></html>`;
}

function runPreview() {
  document.getElementById('preview-frame').srcdoc = buildDocument();
}

window.addEventListener('load', () => {
  runPreview();
  setTimeout(() => { htmlEditor.refresh(); cssEditor.refresh(); jsEditor.refresh(); }, 50);
});
document.getElementById('btn-run').addEventListener('click', runPreview);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   9.  SHARE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const shareBtn = document.getElementById('btn-share');

shareBtn.addEventListener('click', async () => {
  const longURL = buildLongURL();
  shareBtn.textContent = 'â³ Sharingâ€¦';
  shareBtn.classList.add('loading');
  shareBtn.disabled = true;

  let finalURL      = longURL;
  let usedShortener = false;

  try {
    finalURL      = await shortenURL(longURL);
    usedShortener = true;
  } catch (err) {
    console.warn('Shortener failed, using LZString URL:', err);
  }

  try {
    await navigator.clipboard.writeText(finalURL);
    showToast(usedShortener ? `Short link copied! ğŸ‰\n${finalURL}` : 'Link copied! (shortener unavailable) ğŸ‰');
  } catch (_) {
    showToast(`Copy this link:\n${finalURL}`, 6000);
  }

  shareBtn.textContent = 'â˜ Share';
  shareBtn.classList.remove('loading');
  shareBtn.disabled = false;
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   10.  CLEAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('btn-clear').addEventListener('click', () => {
  if (!confirm('Clear all editors?')) return;
  htmlEditor.setValue(''); cssEditor.setValue(''); jsEditor.setValue('');
  runPreview();
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   11.  MOBILE TABS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const tabBtns   = document.querySelectorAll('.tab-btn');
const allPanels = ['html-panel','css-panel','js-panel','preview-panel']
                    .map(id => document.getElementById(id));

tabBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    tabBtns.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const t = btn.dataset.target;
    allPanels.forEach(p => p.classList.toggle('hidden', p.id !== t));
    if (t === 'html-panel') htmlEditor.refresh();
    if (t === 'css-panel')  cssEditor.refresh();
    if (t === 'js-panel')   jsEditor.refresh();
  });
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   12.  DRAG DIVIDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const divider      = document.getElementById('divider');
const editorColumn = document.getElementById('editor-column');
const panelsEl     = document.getElementById('panels');
let isDragging     = false;

divider.addEventListener('mousedown', e => {
  isDragging = true;
  divider.classList.add('dragging');
  document.body.style.cursor     = 'col-resize';
  document.body.style.userSelect = 'none';
  e.preventDefault();
});
document.addEventListener('mousemove', e => {
  if (!isDragging) return;
  const rect = panelsEl.getBoundingClientRect();
  const pct  = Math.min(Math.max((e.clientX - rect.left) / rect.width * 100, 20), 80);
  editorColumn.style.width = pct + '%';
});
document.addEventListener('mouseup', () => {
  if (!isDragging) return;
  isDragging = false;
  divider.classList.remove('dragging');
  document.body.style.cursor = document.body.style.userSelect = '';
  htmlEditor.refresh(); cssEditor.refresh(); jsEditor.refresh();
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   13.  BREAKPOINT WATCHER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const desktopMQ = window.matchMedia('(min-width: 768px)');

function onBreakpointChange(e) {
  if (e.matches) {
    allPanels.forEach(p => p.classList.remove('hidden'));
  } else {
    const t = document.querySelector('.tab-btn.active')?.dataset.target ?? 'html-panel';
    allPanels.forEach(p => p.classList.toggle('hidden', p.id !== t));
  }
  setTimeout(() => { htmlEditor.refresh(); cssEditor.refresh(); jsEditor.refresh(); }, 50);
}

desktopMQ.addEventListener('change', onBreakpointChange);
onBreakpointChange(desktopMQ);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   14.  TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let toastTimer = null;
function showToast(msg, duration = 3000) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => toast.classList.remove('show'), duration);
}
</script>
</body>
</html>
