<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Playground</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Ace Editor (Core) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.7/ace.js"></script>
    <!-- Ace Editor (HTML Mode & Theme) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.7/mode-html.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.7/theme-monokai.min.js"></script>

    <style>
        /* Mobile Tab Active State */
        .tab-active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
            font-weight: 600;
            background-color: #1f2937;
        }
        .tab-inactive {
            color: #9ca3af;
        }

        /* Fix Ace Editor font for different devices */
        #editor { 
            width: 100%;
            height: 100%;
            font-size: 14px;
            line-height: 1.5;
        }
    </style>
</head>
<body class="h-screen flex flex-col bg-gray-900 text-white overflow-hidden">

    <!-- Header -->
    <header class="flex items-center justify-between px-4 py-3 bg-gray-800 border-b border-gray-700 shadow-md z-10 shrink-0">
        <div class="flex items-center gap-2">
            <i data-lucide="code-2" class="w-6 h-6 text-blue-400"></i>
            <h1 class="font-bold text-lg tracking-wide">ITCS333<span class="text-blue-400">Playground</span></h1>
        </div>
        <div class="flex gap-2">
            <button onclick="shareCode()" class="flex items-center gap-2 px-3 py-1.5 text-sm bg-gray-700 hover:bg-gray-600 rounded-md transition-colors border border-gray-600">
                <i data-lucide="share-2" class="w-4 h-4"></i>
                <span class="hidden sm:inline">Share URL</span>
            </button>
            <button onclick="resetCode()" class="flex items-center gap-2 px-3 py-1.5 text-sm bg-red-900/30 hover:bg-red-900/50 text-red-200 rounded-md transition-colors border border-red-900/50">
                <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                <span class="hidden sm:inline">Reset</span>
            </button>
        </div>
    </header>

    <!-- Mobile Tabs -->
    <div id="mobile-tabs" class="flex border-b border-gray-700 bg-gray-800 shrink-0 md:hidden">
        <button onclick="switchTab('editor')" id="tab-editor" class="flex-1 py-3 text-center text-sm tab-active transition-colors">
            Code
        </button>
        <button onclick="switchTab('preview')" id="tab-preview" class="flex-1 py-3 text-center text-sm tab-inactive transition-colors">
            Result
        </button>
    </div>

    <!-- Main Container -->
    <!-- 
       Flex layout logic:
       - Mobile: flex-col, children are toggled via 'hidden' class.
       - Desktop (md): flex-row, 'hidden' classes are overridden by 'md:flex' and 'md:block'.
    -->
    <div id="pane-container" class="flex-1 relative flex flex-col md:flex-row overflow-hidden">
        
        <!-- Editor Pane -->
        <!-- Initially visible on mobile (flex), always visible on desktop (md:flex) -->
        <div id="pane-editor" class="pane flex flex-col relative w-full h-full md:w-1/2 md:flex border-r border-gray-700">
            <!-- Ace Editor Container -->
            <div id="editor"></div>
        </div>

        <!-- Preview Pane -->
        <!-- Initially hidden on mobile (hidden), visible on desktop (md:flex) -->
        <div id="pane-preview" class="pane hidden flex-col relative w-full h-full md:w-1/2 md:flex bg-white">
            <iframe id="preview" class="w-full h-full border-none bg-white block"></iframe>
        </div>

    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 bg-green-600 text-white px-4 py-2 rounded shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 pointer-events-none z-50">
        URL copied to clipboard!
    </div>

    <script>
        // --- 1. Icons & Default Code ---
        lucide.createIcons();

        const defaultCode = `<!DOCTYPE html>
<html>
<head>
</head>
<body>
  <h1>Hello ITCS333</h1>
</body>
</html>`;

        // --- 2. Ace Editor Setup ---
        const editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/html");
        editor.setShowPrintMargin(false);
        editor.setOptions({
            fontSize: "14px",
            wrap: true,
            tabSize: 2,
            useWorker: false 
        });

        // --- 3. Preview Logic with Debounce ---
        let timeout = null;
        
        function updatePreview() {
            const code = editor.getValue();
            const previewFrame = document.getElementById('preview');
            const doc = previewFrame.contentDocument || previewFrame.contentWindow.document;
            
            doc.open();
            doc.write(code);
            doc.close();
        }

        editor.session.on('change', function(delta) {
            clearTimeout(timeout);
            timeout = setTimeout(updatePreview, 500);
        });

        // --- 4. URL State & Sharing ---
        function utf8_to_b64(str) {
            return window.btoa(unescape(encodeURIComponent(str)));
        }

        function b64_to_utf8(str) {
            return decodeURIComponent(escape(window.atob(str)));
        }

        function loadFromUrl() {
            const params = new URLSearchParams(window.location.search);
            const encodedCode = params.get('code');
            
            if (encodedCode) {
                try {
                    const decoded = b64_to_utf8(encodedCode);
                    editor.setValue(decoded, -1);
                } catch (e) {
                    console.error("Decoding error", e);
                    editor.setValue(defaultCode, -1);
                }
            } else {
                editor.setValue(defaultCode, -1);
            }
            updatePreview();
        }

        function shareCode() {
            const code = editor.getValue();
            const encoded = utf8_to_b64(code);
            const url = new URL(window.location);
            url.searchParams.set('code', encoded);
            window.history.pushState({}, '', url);
            navigator.clipboard.writeText(url.toString()).then(() => {
                showToast("Link copied to clipboard!");
            }).catch(err => {
                showToast("URL updated in address bar");
            });
        }

        function resetCode() {
            if(confirm("Are you sure? This will lose current changes.")) {
                editor.setValue(defaultCode, -1);
                const url = new URL(window.location);
                url.searchParams.delete('code');
                window.history.pushState({}, '', url);
            }
        }

        // --- 5. UI Helpers ---

        function switchTab(tab) {
            const paneEditor = document.getElementById('pane-editor');
            const panePreview = document.getElementById('pane-preview');
            const tabEditor = document.getElementById('tab-editor');
            const tabPreview = document.getElementById('tab-preview');

            if (tab === 'editor') {
                // Show Editor, Hide Preview
                paneEditor.classList.remove('hidden');
                paneEditor.classList.add('flex');
                
                panePreview.classList.add('hidden');
                panePreview.classList.remove('flex');
                
                // Tab Styles
                tabEditor.classList.add('tab-active');
                tabEditor.classList.remove('tab-inactive');
                tabPreview.classList.remove('tab-active');
                tabPreview.classList.add('tab-inactive');
                
                // Refresh Ace Editor layout
                editor.resize();
            } else {
                // Hide Editor, Show Preview
                paneEditor.classList.add('hidden');
                paneEditor.classList.remove('flex');
                
                panePreview.classList.remove('hidden');
                panePreview.classList.add('flex');
                
                // Tab Styles
                tabPreview.classList.add('tab-active');
                tabPreview.classList.remove('tab-inactive');
                tabEditor.classList.remove('tab-active');
                tabEditor.classList.add('tab-inactive');
            }
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // --- 6. Start ---
        window.onload = loadFromUrl;

    </script>
</body>
</html>
